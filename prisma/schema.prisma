datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Transactions {
  id           String   @map("id") @db.Char(16)
  version      Int      @default(0) @map("version")
  lineUserId   String   @map("view_user_id") @db.Char(16)
  lineUserName String   @map("viewed_user_id") @db.Char(16)
  viewAt       DateTime @map("view_at")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @default(now()) @updatedAt @map("updated_at")

  viewUser   User @relation("viewUser", fields: [viewUserId], references: [id])
  viewedUser User @relation("viewedUser", fields: [viewedUserId], references: [id])

  @@id(id)
  @@index([viewUserId, viewAt])
  @@index([viewedUserId, viewAt])
  @@map("view_history")
}

model Orders {
  id        String   @map("id") @db.Char(16)
  version   Int      @default(0) @map("version")
  userId    String   @map("user_id") @db.Char(16)
  message   String   @map("message") @db.VarChar(140)
  startAt   DateTime @map("start_at")
  endAt     DateTime @map("end_at")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id])

  @@id(id)
  @@index([userId, startAt])
  @@index([startAt])
  @@map("attraction")
}

model Evaluation {
  id              String   @map("id") @db.Char(16)
  version         Int      @default(0) @map("version")
  reservationId   String   @map("reservation_id") @db.Char(16)
  side            String   @map("side") @db.VarChar(10)
  evaluateUserId  String   @map("evaluate_user_id") @db.Char(16)
  evaluatedUserId String   @map("evaluated_user_id") @db.Char(16)
  score           Int      @map("score") @db.UnsignedInt
  comment         String   @map("comment") @db.VarChar(140)
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at")

  reservation   Reservation @relation(fields: [reservationId], references: [id])
  evaluateUser  User        @relation("evaluateUser", fields: [evaluateUserId], references: [id])
  evaluatedUser User        @relation("evaluatedUser", fields: [evaluatedUserId], references: [id])

  @@id(id)
  @@unique([reservationId, evaluateUserId, evaluatedUserId])
  @@index([side, evaluateUserId])
  @@index([side, evaluatedUserId])
  @@map("evaluation")
}
