datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Transactions {
  id                      String   @map("id") @db.Char(16)
  version                 Int      @default(0) @map("version")
  total                   Int      @default(0) @map("total")
  totalReduced            Int      @default(0) @map("total_reduced")
  tax                     Int      @default(0) @map("tax")
  taxInternal             Int      @default(0) @map("tax_internal")
  taxReduced              Int      @default(0) @map("tax_reduced")
  taxReducedInternal      Int      @default(0) @map("tax_reduced_internal")
  discount                Int      @default(0) @map("discount")
  entryTime               DateTime @map("entry_time")
  outTime                 DateTime @map("out_time")

  createdAt               DateTime @default(now()) @map("created_at")
  updatedAt               DateTime @default(now()) @updatedAt @map("updated_at")

  viewUser   User @relation("viewUser", fields: [viewUserId], references: [id])
  viewedUser User @relation("viewedUser", fields: [viewedUserId], references: [id])

  @@id(id)
  @@index([viewUserId, viewAt])
  @@index([viewedUserId, viewAt])
  @@map("view_history")
}

model OrderHistory {
  id                String   @map("id") @db.Char(16)
  version           Int      @default(0) @map("version")
  transactionId     String   @map("transaction_id") @db.Char(16)
  lineUserId        String   @map("line_user_id") @db.Char(32)
  lineUserName      String   @map("line_user_name") @db.Char(32)
  orderType         DateTime @map("out_time")
  orderedTime       DateTime @map("out_time")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id])

  @@id(id)
  @@index([userId, startAt])
  @@index([startAt])
  @@map("attraction")
}

model OrderItem {
  id                    String  @map("id") @db.Char(16)
  version               Int     @default(0) @map("version")
  orderHistoryId        String  @map("order_history_id") @db.Char(16)
  menuId                Int     @default(0) @map("tax_internal")
  name                  String  @map("line_user_name") @db.Char(32)
  count                 Int     @default(0) @map("tax_internal")
  price                 Int     @default(0) @map("tax_internal")
  unitPrice             Int     @default(0) @map("tax_internal")
  timechargeMinutes     Int     @default(0) @map("tax_internal")

  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at")

  reservation   Reservation @relation(fields: [reservationId], references: [id])
  evaluateUser  User        @relation("evaluateUser", fields: [evaluateUserId], references: [id])
  evaluatedUser User        @relation("evaluatedUser", fields: [evaluatedUserId], references: [id])

  @@id(id)
  @@unique([reservationId, evaluateUserId, evaluatedUserId])
  @@index([side, evaluateUserId])
  @@index([side, evaluatedUserId])
  @@map("evaluation")
}
